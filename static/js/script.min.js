function openTab(e,t){var n,s,a;for(s=document.getElementsByClassName("content"),n=0;n<s.length;n++)s[n].style.display="none";for(a=document.getElementsByClassName("tab-item"),n=0;n<a.length;n++)a[n].className=a[n].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active"}function updateChannels(e){for(var t=0;t<=47;t++)e.channels[t]>$("#cval-"+(t+1)).attr("cvalue")?($("#cval-"+(t+1)).hasClass("purple-text")?$("#cval-"+(t+1)).removeClass("purple-text"):$("#cval-"+(t+1)).removeClass("red-text"),$("#cval-"+(t+1)).addClass("green-text")):e.channels[t]<$("#cval-"+(t+1)).attr("cvalue")?($("#cval-"+(t+1)).hasClass("green-text")?$("#cval-"+(t+1)).removeClass("green-text"):$("#cval-"+(t+1)).removeClass("red-text"),$("#cval-"+(t+1)).addClass("purple-text")):($("#cval-"+(t+1)).hasClass("green-text")?$("#cval-"+(t+1)).removeClass("green-text"):$("#cval-"+(t+1)).removeClass("purple-text"),$("#cval-"+(t+1)).addClass("red-text")),$("#cval-"+(t+1)).text(Math.round(e.channels[t]/255*100)).attr("cvalue",e.channels[t]);return 0}function updateCues(e){if($("#cues").empty(),$("#cues-display").empty(),0!=e.cues.length){null!=e.current_cue?(0!=e.current_cue&&$("#cues-display").append('<div class="cue-item no-hover disable-selection"><h4>Previous: <span class="cue-name">'+e.cues[e.current_cue-1].name+'</span></h4><span class="cue-description">'+e.cues[e.current_cue-1].description+"</span></div>"),$("#cues-display").append('<div class="cue-item no-hover background-green disable-selection"><h4>Current: <span class="cue-name">'+e.cues[e.current_cue].name+'</span></h4><span class="cue-description">'+e.cues[e.current_cue].description+"</span></div>"),e.current_cue!=e.cues.length-1&&e.cues.length>1&&$("#cues-display").append('<div class="cue-item no-hover"><h4>Next: <span class="cue-name">'+e.cues[e.current_cue+1].name+'</span></h4><span class="cue-description">'+e.cues[e.current_cue+1].description+"</span></div>")):$("#cues-display").append('<div class="cue-item no-hover disable-selection"><h4>Next: <span class="cue-name">'+e.cues[0].name+'</span></h4><span class="cue-description">'+e.cues[0].description+"</span></div>");for(var t=0;t<e.cues.length;t++)$("#cues").append('<div class="cue-item disable-selection" cueVal="'+t+'"><h4><span class="cue-name">'+e.cues[t].name+'</span></h4><span class="cue-description">'+e.cues[t].description+"</span></div>"),null!=e.selected_cue&&e.selected_cue==t&&$("div[cueVal="+t+"]").addClass("background-green")}return $(".cue-name").succinct({size:20}),$(".cue-description").succinct({size:70}),null==e.selected_cue&&($("#cueName").val(""),$("#cueDescription").val(""),$("#cueTime").val(""),$("#cueFollow").val("")),0!=e.cues.length?"none"==$(".hidden-item").css("display")&&$(".hidden-item").css("display","inline-block"):$(".hidden-item").css("display","none"),0}function updateSubs(e){if($("#Submasters").empty(),0!=e.submasters.length)for(var t=0;t<e.submasters.length;t++)$("#Submasters").append('<div class="col-1 submaster"><div class="sliders"><div class="slider" id="sub-'+t+'"></div></div><div class="subtitle"><button id="sub-btn-'+t+'" class="btn btn-yellow sub-btn disable-selection">'+e.submasters[t].name+"</button></div></div>");$("#Submasters").append('<div class="col-2 submaster"><button class="btn btn-green disable-selection" id="addSubBtn"><i class="fas fa-plus-square"></i> New Submaster</button></div>');for(var n=$(".slider"),s=0;s<n.length;s++)noUiSlider.create(n[s],{start:e.submasters[s].value,connect:[!0,!1],direction:"rtl",orientation:"vertical",range:{min:0,max:100},format:wNumb({decimals:0})}),n[s].noUiSlider.on("slide",function(){socket.emit("update sub val",{sub:this.target.getAttribute("id"),value:this.get()})});$(".sub-btn").succinct({size:12})}function settingsDropdown(){document.getElementById("settingsDropdown").classList.toggle("show")}var socket=io.connect("http://"+document.domain+":"+location.port+"/tonalite");$(window).bind("load",function(){function e(e){n.noUiSlider.set(e.grandmaster)}document.getElementById("keyboardTabBtn").click();var t=new window.keypress.Listener;t.simple_combo("alt r",function(){socket.emit("command message",{command:"c rs"})}),t.simple_combo("alt c",function(){socket.emit("command message",{command:"r q"})}),t.simple_combo("alt n",function(){socket.emit("cue move",{action:"next"})}),t.simple_combo("alt l",function(){socket.emit("cue move",{action:"last"})});var n=document.getElementById("grandmaster");noUiSlider.create(n,{start:100,connect:[!0,!1],range:{min:0,max:100},format:wNumb({decimals:0})}),n.noUiSlider.on("slide",function(){socket.emit("update grand val",{value:n.noUiSlider.get()})});for(var s=0;s<=47;s++)$("#Channels").append('<div class="col-1 channel disable-selection"><div class="channel-item"><h2>'+(s+1)+'</h2><h1 id="cval-'+(s+1)+'" cvalue="0" class="red-text">0</h1></div></div>');var a=document.getElementById("subSettingsModal"),c=document.getElementsByClassName("sub-modal-close")[0];c.onclick=function(){a.style.display="none"};var o=document.getElementById("usersModal"),i=document.getElementsByClassName("user-modal-close")[0];i.onclick=function(){o.style.display="none"};var l=document.getElementById("disconnectModal");socket.on("connect",function(e){"block"==l.style.display&&(l.style.display="none")}),socket.on("connect_error",function(e){l.style.display="block"}),toastr.options={closeButton:!1,showDuration:"300",hideDuration:"1000",positionClass:"toast-bottom-right",timeOut:"2500"},socket.on("alert",function(e){"error"==e.alertType?toastr.error(e.alert):"warning"==e.alertType?toastr.warning(e.alert):"info"==e.alertType?toastr.info(e.alert):"success"==e.alertType&&toastr.success(e.alert)}),socket.on("update chans",function(e){updateChannels(e)}),socket.on("update chans and subs",function(e){updateChannels(e),updateSubs(e)}),socket.on("update subs",function(e){updateSubs(e)}),socket.on("update cues",function(e){updateCues(e)}),socket.on("cue settings",function(e){updateCues(e),$("#cueName").val(e.name),$("#cueDescription").val(e.description),$("#cueTime").val(e.time),$("#cueFollow").val(e.follow)}),socket.on("sub settings",function(e){if($("#subName").val(e.name),$("#subValue").val(e.value),$("#sub-channels").empty(),0!=e.channels.length)for(var t=0;t<e.channels.length;t++)$("#sub-channels").append('<div class="col-5"><input type="number" placeholder="Channel:" value="'+e.channels[t].channel+'" id="sub-channel-'+t+'-channel" min="1" max="48"></div><div class="col-5"><input type="number" placeholder="Value:" value="'+e.channels[t].value+'" id="sub-channel-'+t+'-value" min="0" max="100"></div><div class="col-1"><button class="btn btn-green btn-full btn-tall sub-chan-save" subChan="'+t+'"><i class="fas fa-save"></i></button></div><div class="col-1"><button class="btn btn-red btn-full btn-tall sub-chan-delete" subChan="'+t+'"><i class="fas fa-trash-alt"></i></button></div>');a.style.display="block"}),socket.on("update all",function(t){if(updateChannels(t),updateCues(t),updateSubs(t),e(t),""!=t.show.name&&($("#showName").val(t.show.name),$("#showDescription").val(t.show.description),$("#showAuthor").val(t.show.author),$("#showCopyright").val(t.show.copyright)),$("#serverIP").val(t.tonaliteSettings.serverIP),$("#serverPort").val(t.tonaliteSettings.serverPort),$("#sacnIP").val(t.tonaliteSettings.sacnIP),$("#users").empty(),0!=t.tonaliteSettings.users.length)for(var n=0;n<t.tonaliteSettings.users.length;n++)$("#users").append('<div class="col-11"><input type="text" placeholder="User:" value="'+t.tonaliteSettings.users[n][0]+'" ></div><div class="col-1"><button class="btn btn-red btn-full btn-tall user-delete" user="'+n+'"><i class="fas fa-trash-alt"></i></button></div>')}),socket.on("set grand val",function(t){updateChannels(t),e(t)}),socket.on("update chans and cues",function(e){updateChannels(e),updateCues(e)}),socket.on("update settings",function(e){$("#serverIP").val(e.tonaliteSettings.serverIP),$("#serverPort").val(e.tonaliteSettings.serverPort),$("#sacnIP").val(e.tonaliteSettings.sacnIP)}),socket.on("redirect",function(e){window.location="http://"+document.domain+":"+location.port+e.url}),$(".kbtn").click(function(){$("#commandInput").val($("#commandInput").val()+$(this).attr("inputVal")),$("#commandInput").focus()}),$("#updateCue").click(function(){socket.emit("update cue","nothing")}),$("#saveCue").click(function(){socket.emit("save cue",{name:$("#cueName").val(),description:$("#cueDescription").val(),time:$("#cueTime").val(),follow:$("#cueFollow").val()})}),$("#cues").on("click","div.cue-item",function(){socket.emit("cue info",{cue_id:$(this).attr("cueVal")})}),$("#Submasters").on("click","button.sub-btn",function(){socket.emit("sub info",{sub:this.id})}),$("#Submasters").on("click","button#addSubBtn",function(){socket.emit("add sub","nothing")}),$("#deleteSubBtn").click(function(){a.style.display="none",socket.emit("remove sub","nothing")}),$("#sub-channels").on("click","button.sub-chan-save",function(){socket.emit("edit sub chan",{action:"save",chan:Math.round(this.getAttribute("subChan")),channel:$("#sub-channel-"+Math.round(this.getAttribute("subChan"))+"-channel").val(),value:$("#sub-channel-"+Math.round(this.getAttribute("subChan"))+"-value").val()})}),$("#sub-channels").on("click","button.sub-chan-delete",function(){socket.emit("edit sub chan",{action:"delete",chan:Math.round(this.getAttribute("subChan"))})}),$("#users").on("click","button.user-delete",function(){socket.emit("edit users",{action:"delete",user:Math.round(this.getAttribute("user"))})}),$("#addUserBtn").click(function(){socket.emit("edit users",{action:"new",user:prompt("Please enter the new username"),password:prompt("Please enter the new password")})}),$("#commandSubmitBtn").click(function(){socket.emit("command message",{command:$("#commandInput").val()}),$("#commandInput").val("")}),$("#commandReleaseBtn").click(function(){socket.emit("command message",{command:"c rs"})}),$("#recordCueBtn").click(function(){socket.emit("command message",{command:"r q"})}),$("#cueUpBtn").click(function(){socket.emit("cue move",{action:"up"})}),$("#cueDownBtn").click(function(){socket.emit("cue move",{action:"down"})}),$("#deleteCue").click(function(){socket.emit("cue move",{action:"delete"})}),$("#duplicateCue").click(function(){socket.emit("cue move",{action:"duplicate"})}),$("#goCue").click(function(){socket.emit("command message",{command:"q 9949"})}),$("#nextCue").click(function(){socket.emit("cue move",{action:"next"})}),$("#releaseCues").click(function(){socket.emit("cue move",{action:"release"})}),$("#lastCue").click(function(){socket.emit("cue move",{action:"last"})}),$("#saveShowBtn").click(function(){socket.emit("save show",{name:$("#showName").val(),description:$("#showDescription").val(),author:$("#showAuthor").val(),copyright:$("#showCopyright").val()})}),$("#saveSubSettingsBtn").click(function(){socket.emit("save sub",{name:$("#subName").val(),value:$("#subValue").val()})}),$("#addSubChanBtn").click(function(){socket.emit("add sub chan","nothing")}),$("#clearShowBtn").click(function(){confirm("Are you sure you want clear everything?")&&($("#showName").val(""),$("#showDescription").val(""),$("#showAuthor").val(""),$("#showCopyright").val(""),socket.emit("clear show","none"))}),$("#commandClearBtn").click(function(){$("#commandInput").val("")}),$("#commandInput").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;"13"==t&&(socket.emit("command message",{command:$("#commandInput").val()}),$("#commandInput").val(""))}),$("#usersBtn").click(function(){o.style.display="block"}),$(".saveSettingsBtn").click(function(){alert("The server must be restarted for IP changes to take effect."),socket.emit("save settings",{serverIP:$("#serverIP").val(),serverPort:$("#serverPort").val(),sacnIP:$("#sacnIP").val()})}),$("#resetSettingsBtn").click(function(){$("#serverIP").val("127.0.0.1"),$("#serverPort").val("9898"),$("#sacnIP").val("127.0.0.1")})});