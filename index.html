<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Tonalite Client</title>
        <link href="/static/css/style.css" rel="stylesheet">
        <script src="/static/js/jquery-3.2.1.min.js"></script>
        <script src="/static/js/socket.io.js"></script>
        <script src="/static/js/isMobile.min.js"></script>
        <script>
            (function () {
                var MOBILE_SITE = '/mobile';
                if (isMobile.any) {
                    document.location = MOBILE_SITE;
                }
            })();
        </script>
        <script type="text/javascript" charset="utf-8">
        function openTab(evt, cityName) {
            // Declare all variables
            var i, tabcontent, tablinks;

            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(cityName).style.display = "flex";
            evt.currentTarget.className += " active";
        }
        $(document).ready(function(){
            namespace = '/tonalite';

            for(var i = 0; i <= 512; i++) {
                $("#channels").append("<div class=\"tombstone\"><h1 class=\"subtitle channelNum\">"+i+"</h1> \
                                       <input type=\"number\" class=\"channelVal\" min=\"0\" max=\"255\" value=\"0\" id=\"cval-"+i+"\"></div>");                
            }
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

            socket.on('my response', function(msg) {
                /*console.log('Received: ' + msg.data);*/
                for(var i = 0; i <= 512; i++) {
                    $("#cval-"+(i+1)).val(msg.data[i])
                }
            });

            $('form#command').submit(function(event) {
                socket.emit('command message', {data: $('#command_data').val()});
                $('#command_data').val("");
                return false;
            });

            $('.channelVal').change(function(event) {
                socket.emit('update chan', {val: $("#"+this.id).val(), chan: this.id});
                return false;
            });

            $('.keypad-btn').click(function(event) {
                $('#command_data').val($('#command_data').val() + $(this).attr('inputVal'));
            });
        });
        </script>
    </head>
    <body>
        <div class="tab">
            <button class="tablinks btn btn-primary" onclick="openTab(event, 'channels')">Channels</button>
            <button class="tablinks btn btn-primary" onclick="openTab(event, 'keypad')">Keypad</button>
            <button class="tablinks btn btn-primary" onclick="openTab(event, 'slidercues')">Sliders and Cues</button>
        </div>
        <br>
        <div id="channels" class="tabcontent"></div>
        <div id="keypad" class="tabcontent">
            <div>
                <div class="helpers">
                    <button class="keypad-btn btn btn-secondary" inputVal="c ">Channel</button>
                    <button class="keypad-btn btn btn-secondary" inputVal="q ">Cue</button>
                    <button class="keypad-btn btn btn-secondary" inputVal="sh">Show</button>
                </div>
                <div class="helpers">
                    <button class="keypad-btn btn btn-secondary" inputVal=" r">Record</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" t ">Time</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" n">Next</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" l">Last</button>
                </div>
            </div>
            <div>
                <div class="helpers">
                    <button class="keypad-btn btn btn-secondary" inputVal=" a ">At</button>
                    <button class="keypad-btn btn btn-secondary" inputVal="+">And</button>
                    <button class="keypad-btn btn btn-secondary" inputVal="-">Through</button>
                </div>
                <div class="helpers">
                    <button class="keypad-btn btn btn-secondary" inputVal=" g">Go</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" s">Stop</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" op ">Open</button>
                    <button class="keypad-btn btn btn-secondary" inputVal=" sv ">Save</button>
                </div>
            </div>
            <div>
                <div class="numbers">
                    <div>
                        <button class="keypad-btn btn btn-primary" inputVal="1">1</button>
                        <button class="keypad-btn btn btn-primary" inputVal="2">2</button>
                        <button class="keypad-btn btn btn-primary" inputVal="3">3</button>
                    </div>
                    <div>
                        <button class="keypad-btn btn btn-primary" inputVal="4">4</button>
                        <button class="keypad-btn btn btn-primary" inputVal="5">5</button>
                        <button class="keypad-btn btn btn-primary" inputVal="6">6</button>
                    </div>
                    <div>
                        <button class="keypad-btn btn btn-primary" inputVal="7">7</button>
                        <button class="keypad-btn btn btn-primary" inputVal="8">8</button>
                        <button class="keypad-btn btn btn-primary" inputVal="9">9</button>
                    </div>
                    <div>
                        <button class="keypad-btn btn btn-primary" inputVal="d">+</button>
                        <button class="keypad-btn btn btn-primary" inputVal="0">0</button>
                        <button class="keypad-btn btn btn-primary" inputVal="b">-</button>
                    </div>
                </div>
                <div class="commandBox">
                    <form id="command" method="POST" action='#'>
                        <input type="text" name="command_data" id="command_data" placeholder="Command here">
                        <button type="submit" class="btn btn-secondary" id="submit_btn">Please</button>
                        <button type="reset" class="btn btn-primary" id="clr_btn">Clr</button>
                    </form>
                </div>
            </div>
        </div>
        <div id="slidercues" class="tabcontent"></div>
    </body>
</html>